-- [[ PRE-LOAD PROTECTION ]] --
task.spawn(function()
    local function disableAC()
        local char = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
        local hb = char:WaitForChild("Hitbox", 5)
        if hb then
            local ac = hb:WaitForChild("LocalAntiCheat", 5)
            if ac then
                ac.Disabled = true
                print("Pharmacii Hub: Anti-Cheat Disabled")
            end
        end
    end
    disableAC()
    game.Players.LocalPlayer.CharacterAdded:Connect(disableAC)
end)

local uis = game:GetService("UserInputService")
local ts = game:GetService("TweenService")
local rs = game:GetService("RunService")
local p = game.Players.LocalPlayer
local teleportService = game:GetService("TeleportService")
local vim = game:GetService("VirtualInputManager") -- Added for Auto Tuck

-- [[ GLOBAL SETTINGS ]] --
_G.HideKey = Enum.KeyCode.LeftControl
_G.MagRange = 10
_G.TuckSpeed = 100
_G.WalkSpeed = 16
_G.JumpPower = 50
_G.InfiniteJump = false

local activeTabBtn = nil
local canDrag = true 
local MagnetEnabled = false 
local AutoTuckEnabled = false
local NoclipEnabled = false
local AdvancedBlocking = false 
local binding = false

-- Clean up old UI
if game:GetService("CoreGui"):FindFirstChild("PharmaciiHub_Master") then
    game:GetService("CoreGui").PharmaciiHub_Master:Destroy()
end

local MainGui = Instance.new("ScreenGui", game:GetService("CoreGui"))
MainGui.Name = "PharmaciiHub_Master"

-- [[ MAIN UI ]] --
local Main = Instance.new("Frame", MainGui)
Main.Size = UDim2.new(0, 800, 0, 480)
Main.Position = UDim2.new(0.5, -400, 0.5, -240)
Main.BackgroundColor3 = Color3.fromRGB(12, 12, 14) 
Main.BorderSizePixel = 0
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 6)

-- [[ DRAGGABLE LOGIC ]] --
local dragging, dragStart, startPos
Main.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 and canDrag then
        dragging = true; dragStart = input.Position; startPos = Main.Position
    end
end)
uis.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
uis.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)

-- [[ HEADER ]] --
local Header = Instance.new("Frame", Main)
Header.Size = UDim2.new(1, 0, 0, 40); Header.BackgroundTransparency = 1
local Title = Instance.new("TextLabel", Header)
Title.Text = "Pharmacii Hub"; Title.TextColor3 = Color3.fromRGB(255, 0, 50)
Title.Font = "GothamBold"; Title.TextSize = 16; Title.Size = UDim2.new(0, 200, 1, 0); Title.Position = UDim2.new(0, 30, 0, 0)
Title.TextXAlignment = "Left"; Title.BackgroundTransparency = 1

-- [[ SIDEBAR ]] --
local Sidebar = Instance.new("Frame", Main)
Sidebar.Size = UDim2.new(0, 220, 1, -40); Sidebar.Position = UDim2.new(0, 0, 0, 40)
Sidebar.BackgroundColor3 = Color3.fromRGB(16, 16, 18); Sidebar.BorderSizePixel = 0

local TabScroller = Instance.new("ScrollingFrame", Sidebar)
TabScroller.Size = UDim2.new(1, 0, 1, -120); TabScroller.Position = UDim2.new(0, 0, 0, 10)
TabScroller.BackgroundTransparency = 1; TabScroller.ScrollBarThickness = 0
local TabLayout = Instance.new("UIListLayout", TabScroller); TabLayout.Padding = UDim.new(0, 5); TabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- [[ OUTPUT CONSOLE ]] --
local OutputFrame = Instance.new("ScrollingFrame", Main)
OutputFrame.Size = UDim2.new(1, -240, 0, 80); OutputFrame.Position = UDim2.new(0, 230, 1, -95)
OutputFrame.BackgroundColor3 = Color3.fromRGB(16, 16, 18); OutputFrame.BorderSizePixel = 0; OutputFrame.ScrollBarThickness = 2
Instance.new("UICorner", OutputFrame)
local OutputLayout = Instance.new("UIListLayout", OutputFrame); OutputLayout.Padding = UDim.new(0, 2)

local function Log(text)
    local l = Instance.new("TextLabel", OutputFrame)
    l.Size = UDim2.new(1, -10, 0, 18); l.BackgroundTransparency = 1; l.TextColor3 = Color3.fromRGB(200, 200, 200)
    l.Font = "Code"; l.TextSize = 11; l.Text = " > " .. text; l.TextXAlignment = "Left"
    OutputFrame.CanvasSize = UDim2.new(0, 0, 0, OutputLayout.AbsoluteContentSize.Y)
    OutputFrame.CanvasPosition = Vector2.new(0, OutputLayout.AbsoluteContentSize.Y)
end

-- [[ TABS SYSTEM ]] --
local Pages = Instance.new("Frame", Main)
Pages.Size = UDim2.new(1, -240, 1, -160); Pages.Position = UDim2.new(0, 230, 0, 50); Pages.BackgroundTransparency = 1

local function AddTab(name, subtext, iconId, isSettings)
    local Page = Instance.new("ScrollingFrame", Pages); Page.Size = UDim2.new(1, 0, 1, 0); Page.Visible = false; Page.BackgroundTransparency = 1; Page.ScrollBarThickness = 0
    Instance.new("UIListLayout", Page).Padding = UDim.new(0, 10)

    local Btn = Instance.new("TextButton"); Btn.Size = UDim2.new(0, 200, 0, 50); Btn.BackgroundColor3 = Color3.fromRGB(16, 16, 18); Btn.Text = ""; Instance.new("UICorner", Btn)
    local Icon = Instance.new("ImageLabel", Btn); Icon.Size = UDim2.new(0, 20, 0, 20); Icon.Position = UDim2.new(0, 12, 0.5, -10); Icon.BackgroundTransparency = 1; Icon.Image = "rbxassetid://" .. tostring(iconId); Icon.ImageColor3 = Color3.fromRGB(255, 0, 50) 
    local L = Instance.new("TextLabel", Btn); L.Text = name; L.Size = UDim2.new(1, -55, 0, 25); L.Position = UDim2.new(0, 42, 0, 5); L.TextColor3 = Color3.new(1,1,1); L.Font = "GothamBold"; L.TextSize = 13; L.TextXAlignment = "Left"; L.BackgroundTransparency = 1
    local S = Instance.new("TextLabel", Btn); S.Text = subtext; S.Size = UDim2.new(1, -55, 0, 15); S.Position = UDim2.new(0, 42, 0, 23); S.TextColor3 = Color3.fromRGB(150, 150, 150); S.Font = "Gotham"; S.TextSize = 10; S.TextXAlignment = "Left"; S.BackgroundTransparency = 1
    
    Btn.Parent = isSettings and Sidebar or TabScroller
    if isSettings then Btn.Position = UDim2.new(0.5, -100, 1, -115) end

    Btn.MouseButton1Click:Connect(function()
        if activeTabBtn then ts:Create(activeTabBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(16, 16, 18)}):Play() end
        activeTabBtn = Btn; ts:Create(Btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(35, 35, 38)}):Play()
        for _, pge in pairs(Pages:GetChildren()) do if pge:IsA("ScrollingFrame") then pge.Visible = false end end Page.Visible = true
    end)
    return Page
end

-- [[ FEATURE BUILDERS ]] --
local function CreateButton(parent, text, cb)
    local B = Instance.new("TextButton", parent); B.Size = UDim2.new(1, -20, 0, 40); B.BackgroundColor3 = Color3.fromRGB(25, 25, 28); B.TextColor3 = Color3.new(1,1,1); B.Font = "GothamBold"; B.TextSize = 13; B.Text = text; Instance.new("UICorner", B)
    B.MouseButton1Click:Connect(function() cb(B) end)
    return B
end

local function CreateFeature(parent, title, subText, hasSlider, defaultVal, maxVal, typeKey, callback)
    local Container = Instance.new("Frame", parent); Container.Size = UDim2.new(1, -20, 0, 60); Container.BackgroundColor3 = Color3.fromRGB(16, 16, 18); Container.ClipsDescendants = true; Instance.new("UICorner", Container)
    local Label = Instance.new("TextLabel", Container); Label.Text = title; Label.Size = UDim2.new(0.6, 0, 0, 60); Label.Position = UDim2.new(0, 20, 0, 0); Label.TextColor3 = Color3.new(1,1,1); Label.Font = "GothamBold"; Label.TextSize = 13; Label.TextXAlignment = "Left"; Label.BackgroundTransparency = 1
    local Toggle = Instance.new("TextButton", Container); Toggle.Size = UDim2.new(0, 36, 0, 18); Toggle.Position = UDim2.new(1, -50, 0, 21); Toggle.BackgroundColor3 = Color3.fromRGB(45, 45, 48); Toggle.Text = ""; Instance.new("UICorner", Toggle).CornerRadius = UDim.new(1, 0)
    local Dot = Instance.new("Frame", Toggle); Dot.Size = UDim2.new(0, 14, 0, 14); Dot.Position = UDim2.new(0, 2, 0.5, -7); Dot.BackgroundColor3 = Color3.new(1,1,1); Instance.new("UICorner", Dot).CornerRadius = UDim.new(1, 0)

    if hasSlider then
        local SliderFrame = Instance.new("Frame", Container); SliderFrame.Size = UDim2.new(1, -40, 0, 40); SliderFrame.Position = UDim2.new(0, 20, 0, 60); SliderFrame.BackgroundTransparency = 1
        local SLabel = Instance.new("TextLabel", SliderFrame); SLabel.Text = subText .. ": " .. defaultVal; SLabel.Size = UDim2.new(1,0,0,15); SLabel.TextColor3 = Color3.fromRGB(150, 150, 155); SLabel.Font = "Gotham"; SLabel.TextSize = 11; SLabel.BackgroundTransparency = 1; SLabel.TextXAlignment = "Left"
        local Bg = Instance.new("Frame", SliderFrame); Bg.Size = UDim2.new(1, 0, 0, 6); Bg.Position = UDim2.new(0, 0, 0, 25); Bg.BackgroundColor3 = Color3.fromRGB(40, 40, 42); Instance.new("UICorner", Bg)
        local Fill = Instance.new("Frame", Bg); Fill.Size = UDim2.new(defaultVal/maxVal, 0, 1, 0); Fill.BackgroundColor3 = Color3.fromRGB(255, 0, 50); Instance.new("UICorner", Fill)
        Bg.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                canDrag = false
                local move; move = uis.InputChanged:Connect(function(m)
                    if m.UserInputType == Enum.UserInputType.MouseMovement then
                        local pos = math.clamp((m.Position.X - Bg.AbsolutePosition.X) / Bg.AbsoluteSize.X, 0, 1)
                        Fill.Size = UDim2.new(pos, 0, 1, 0)
                        local val = math.floor(pos * maxVal); SLabel.Text = subText .. ": " .. val; callback(val)
                    end
                end)
                uis.InputEnded:Connect(function(up) if up.UserInputType == Enum.UserInputType.MouseButton1 then move:Disconnect(); canDrag = true end end)
            end
        end)
    end

    local active = false
    Toggle.MouseButton1Click:Connect(function()
        active = not active
        if typeKey == "Magnet" then MagnetEnabled = active 
        elseif typeKey == "Tuck" then AutoTuckEnabled = active
        elseif typeKey == "Block" then AdvancedBlocking = active 
        elseif typeKey == "InfJump" then _G.InfiniteJump = active
        elseif typeKey == "Noclip" then NoclipEnabled = active end
        local h = (active and hasSlider) and 120 or 60
        ts:Create(Container, TweenInfo.new(0.3), {Size = UDim2.new(1, -20, 0, h)}):Play()
        ts:Create(Toggle, TweenInfo.new(0.2), {BackgroundColor3 = active and Color3.fromRGB(255, 0, 50) or Color3.fromRGB(45, 45, 48)}):Play()
        ts:Create(Dot, TweenInfo.new(0.2), {Position = active and UDim2.new(1, -17, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)}):Play()
        Log(title .. (active and " On" or " Off"))
    end)
end

-- [[ TABS SETUP ]] --
local CatchTab = AddTab("Catching", "Magnets, etc", 10734897102)
local PhysicsTab = AddTab("Physics", "Block, etc", 10723343321)
local PlayerTab = AddTab("Player", "Movement, etc", 10723350321)
local SettingsTab = AddTab("Settings", "Configuration", 10723344435, true)

-- [[ FEATURES ]] --
CreateFeature(CatchTab, "Ball Magnet", "Range", true, 10, 50, "Magnet", function(v) _G.MagRange = v end)
CreateFeature(CatchTab, "Auto Tuck", "Speed (ms)", true, 100, 1000, "Tuck", function(v) _G.TuckSpeed = v end)
CreateFeature(PhysicsTab, "Advanced Blocking", "", false, 0, 0, "Block", function() end)
CreateFeature(PlayerTab, "Walkspeed", "Speed", true, 16, 250, "None", function(v) _G.WalkSpeed = v end)
CreateFeature(PlayerTab, "JumpPower", "Power", true, 50, 500, "None", function(v) _G.JumpPower = v end)
CreateFeature(PlayerTab, "Infinite Jump", "Air Walk", false, 0, 0, "InfJump", function() end)
CreateFeature(PlayerTab, "Noclip", "No Walls", false, 0, 0, "Noclip", function() end)

-- [[ SETTINGS ]] --
CreateButton(SettingsTab, "Menu Bind: " .. _G.HideKey.Name, function(btn)
    binding = true; btn.Text = "Menu Bind: ..."
    local conn; conn = uis.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.Keyboard then
            _G.HideKey = i.KeyCode; btn.Text = "Menu Bind: " .. i.KeyCode.Name; binding = false; conn:Disconnect()
        end
    end)
end)
CreateButton(SettingsTab, "Rejoin Server", function() teleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, p) end)
CreateButton(SettingsTab, "Infinite Yield", function() loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))() end)

-- [[ PROFILE ]] --
local Prof = Instance.new("Frame", Sidebar); Prof.Size = UDim2.new(1, 0, 0, 60); Prof.Position = UDim2.new(0, 0, 1, -60); Prof.BackgroundTransparency = 1
local Av = Instance.new("ImageLabel", Prof); Av.Size = UDim2.new(0, 40, 0, 40); Av.Position = UDim2.new(0, 15, 0.5, -20); Av.Image = game:GetService("Players"):GetUserThumbnailAsync(p.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420); Instance.new("UICorner", Av).CornerRadius = UDim.new(1, 0)
local Us = Instance.new("TextLabel", Prof); Us.Text = p.DisplayName; Us.Position = UDim2.new(0, 65, 0.5, -10); Us.TextColor3 = Color3.new(1,1,1); Us.Font = "GothamBold"; Us.TextSize = 14; Us.BackgroundTransparency = 1; Us.TextXAlignment = "Left"

-- [[ AUTO TUCK ENGINE ]] --
local function HandleAutoTuck(child)
    if AutoTuckEnabled and child:IsA("Tool") and child.Name == "Football" then
        task.wait(_G.TuckSpeed / 1000)
        vim:SendKeyEvent(true, Enum.KeyCode.E, false, game)
        task.wait(0.05)
        vim:SendKeyEvent(false, Enum.KeyCode.E, false, game)
        Log("Auto Tucked: Pressing E (" .. _G.TuckSpeed .. "ms)")
    end
end

p.Backpack.ChildAdded:Connect(HandleAutoTuck)
p.CharacterAdded:Connect(function(char)
    char.ChildAdded:Connect(HandleAutoTuck)
end)
if p.Character then p.Character.ChildAdded:Connect(HandleAutoTuck) end

-- [[ MAIN ENGINE ]] --
uis.InputBegan:Connect(function(i, g) if not g and not binding and i.KeyCode == _G.HideKey then Main.Visible = not Main.Visible end end)
uis.JumpRequest:Connect(function() if _G.InfiniteJump then p.Character:FindFirstChildOfClass("Humanoid"):ChangeState(Enum.HumanoidStateType.Jumping) end end)

rs.Heartbeat:Connect(function()
    local char = p.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if hum then hum.WalkSpeed = _G.WalkSpeed; hum.JumpPower = _G.JumpPower; hum.UseJumpPower = true end
    
    if NoclipEnabled and char then
        for _, v in pairs(char:GetDescendants()) do if v:IsA("BasePart") then v.CanCollide = false end end
    end

    local ball = workspace:FindFirstChild("Football") or workspace:FindFirstChild("Ball")
    local hand = char and (char:FindFirstChild("RightHand") or char:FindFirstChild("Right Arm"))

    -- Magnet Logic
    if MagnetEnabled and uis:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
        if ball and hand and (ball.Position - hand.Position).Magnitude <= _G.MagRange then
            ball.Velocity = Vector3.zero; ball.CFrame = hand.CFrame
        end
    end

    -- Blocking Logic
    for _, player in pairs(game:GetService("Players"):GetPlayers()) do
        local character = player.Character
        if character and character.Name ~= p.Name then
            local jersey = character:FindFirstChild("Jersey") or character:FindFirstChild("Hitbox")
            if jersey then
                jersey.Size = AdvancedBlocking and Vector3.new(10, 10, 10) or Vector3.new(2, 2, 1)
                jersey.CanCollide = false
            end
        end
    end
end)

CatchTab.Visible = true
Log("Pharmacii Hub: Fully Loaded & AC Disabled.")
